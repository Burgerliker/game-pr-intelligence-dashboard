services:
  backend-live:
    profiles: ["live"]
    build:
      context: .
      dockerfile: Dockerfile.backend
    env_file:
      - .env.live
    environment:
      - LIVE_DB_PATH=backend/data/articles.db
      - BACKTEST_DB_PATH=backend/data/articles_backtest.db
      - ENABLE_DEBUG_ENDPOINTS=${ENABLE_DEBUG_ENDPOINTS:-0}
      - ENABLE_MANUAL_COLLECTION=${ENABLE_MANUAL_COLLECTION:-0}
      - SCHEDULER_LOG_TTL_DAYS=${SCHEDULER_LOG_TTL_DAYS:-7}
      - TEST_ARTICLE_TTL_HOURS=${TEST_ARTICLE_TTL_HOURS:-24}
    ports:
      - "8000:8000"
    volumes:
      - ./backend/data:/app/backend/data
    restart: unless-stopped

  backend-backtest:
    profiles: ["backtest"]
    build:
      context: .
      dockerfile: Dockerfile.backend
    env_file:
      - .env.backtest
    environment:
      - LIVE_DB_PATH=backend/data/articles_backtest.db
      - BACKTEST_DB_PATH=backend/data/articles_backtest.db
      - ENABLE_DEBUG_ENDPOINTS=${ENABLE_DEBUG_ENDPOINTS:-0}
      - ENABLE_MANUAL_COLLECTION=${ENABLE_MANUAL_COLLECTION:-0}
      - SCHEDULER_LOG_TTL_DAYS=${SCHEDULER_LOG_TTL_DAYS:-7}
      - TEST_ARTICLE_TTL_HOURS=${TEST_ARTICLE_TTL_HOURS:-24}
    ports:
      - "8001:8000"
    volumes:
      - ./backend/data:/app/backend/data
    restart: unless-stopped

  frontend-live:
    profiles: ["live"]
    build:
      context: ./frontend
      dockerfile: Dockerfile
    env_file:
      - .env.live
    environment:
      - NEXT_PUBLIC_API_BASE_URL=http://localhost:8000
    ports:
      - "3000:3000"
    depends_on:
      - backend-live
    restart: unless-stopped

  frontend-backtest:
    profiles: ["backtest"]
    build:
      context: ./frontend
      dockerfile: Dockerfile
    env_file:
      - .env.backtest
    environment:
      - NEXT_PUBLIC_API_BASE_URL=http://localhost:8001
    ports:
      - "3001:3000"
    depends_on:
      - backend-backtest
    restart: unless-stopped
